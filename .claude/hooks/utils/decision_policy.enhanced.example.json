{
  "metadata": {
    "description": "Enhanced Herald decision policy with tag-based rules and severity levels",
    "version": 2,
    "notes": [
      "Copy this file to decision_policy.json and customize as needed.",
      "Tag-based rules are easier to maintain than regex patterns.",
      "Built-in tag patterns cover common scenarios (package management, git operations, etc.).",
      "Severity levels allow fine-grained control over decision thresholds.",
      "Rules are evaluated top-to-bottom; first match wins."
    ]
  },
  "pre_tool_use": {
    "rules": [
      {
        "name": "block_system_destruction",
        "tags": ["system:dangerous"],
        "action": "deny",
        "severity": "critical",
        "reason": "Destructive system commands are blocked for safety"
      },
      {
        "name": "confirm_package_installs",
        "tags": ["package:install"],
        "action": "ask",
        "severity": "medium",
        "reason": "Package installations should be reviewed"
      },
      {
        "name": "confirm_git_destructive",
        "tags": ["git:destructive"],
        "action": "ask",
        "severity": "high",
        "reason": "Destructive git operations require confirmation"
      },
      {
        "name": "protect_secrets",
        "tags": ["files:secrets"],
        "action": "deny",
        "severity": "critical",
        "reason": "Secret and credential files are protected"
      },
      {
        "name": "review_config_changes",
        "tags": ["files:config"],
        "action": "ask",
        "severity": "medium",
        "reason": "Configuration file changes should be reviewed"
      },
      {
        "name": "custom_curl_pipe_block",
        "type": "command",
        "pattern": "curl.*\\|.*(sh|bash)",
        "action": "deny",
        "severity": "high",
        "reason": "Piping remote scripts to shell is dangerous"
      }
    ],
    "severity_thresholds": {
      "critical": "deny",
      "high": "ask",
      "medium": "ask",
      "low": "allow"
    },
    "built_in_tags": {
      "package:install": [
        "npm install",
        "pip install",
        "poetry add",
        "yarn add",
        "uv pip install",
        "brew install",
        "apt install"
      ],
      "package:uninstall": [
        "npm uninstall",
        "pip uninstall",
        "poetry remove"
      ],
      "git:destructive": [
        "git reset --hard",
        "git clean -fd",
        "git rebase --abort"
      ],
      "git:history": [
        "git rebase -i",
        "git commit --amend",
        "git cherry-pick"
      ],
      "system:dangerous": [
        "rm -rf /",
        "sudo rm -rf",
        "chmod 777",
        "mkfs.",
        "dd if="
      ],
      "system:admin": [
        "sudo ",
        "systemctl stop",
        "systemctl restart"
      ],
      "files:secrets": [
        ".env",
        "id_rsa",
        "id_ed25519",
        ".key",
        "password",
        "secret"
      ],
      "files:config": [
        "package.json",
        "pyproject.toml",
        "Cargo.toml",
        "requirements.txt"
      ]
    },
    "default": {
      "action": "allow"
    }
  },
  "post_tool_use": {
    "block_on_error": true,
    "error_keys": ["toolError", "error", "traceback"],
    "block_exit_codes_at_least": 1,
    "severity_thresholds": {
      "critical": "block",
      "high": "block",
      "medium": "allow",
      "low": "allow"
    }
  },
  "stop": {
    "block_on_loop": true,
    "max_consecutive_stops": 3,
    "loop_detection": {
      "fields": ["loopDetected", "loop_detected"],
      "summary_keywords": ["loop", "infinite", "repeated"]
    }
  }
}